{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Install Backend Dependencies",
      "type": "shell",
      "command": "cd backend && uv sync",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Install Frontend Dependencies",
      "type": "shell",
      "command": "cd frontend && npm install",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Install All Dependencies",
      "dependsOn": [
        "Install Backend Dependencies",
        "Install Frontend Dependencies"
      ],
      "dependsOrder": "parallel",
      "group": "none",
      "presentation": {
        "reveal": "always"
      }
    },
    {
      "label": "Run Backend (Development)",
      "type": "shell",
      "command": "cd backend && uv run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000",
      "group": "none",
      "isBackground": true,
      "problemMatcher": {
        "pattern": {
          "regexp": "^.*$",
          "file": 1,
          "location": 2,
          "message": 3
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^.*Uvicorn running.*$",
          "endsPattern": "^.*Application startup complete.*$"
        }
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "group": "backend"
      }
    },
    {
      "label": "Run Frontend (Development)",
      "type": "shell",
      "command": "cd frontend && npm run dev",
      "group": "none",
      "isBackground": true,
      "problemMatcher": {
        "pattern": {
          "regexp": "^.*$",
          "file": 1,
          "location": 2,
          "message": 3
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^.*VITE.*$",
          "endsPattern": "^.*Local:.*http.*$"
        }
      },
      "presentation": {
        "reveal": "always",
        "panel": "dedicated",
        "group": "frontend"
      }
    },
    {
      "label": "Build Frontend",
      "type": "shell",
      "command": "cd frontend && npm run build",
      "group": "build",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Database Migrations: Upgrade",
      "type": "shell",
      "command": "cd backend && uv run alembic upgrade head",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Database Migrations: Create",
      "type": "shell",
      "command": "cd backend && uv run alembic revision --autogenerate -m \"${input:migrationMessage}\"",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Database Migrations: Downgrade",
      "type": "shell",
      "command": "cd backend && uv run alembic downgrade -1",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Lint Backend (Type Check)",
      "type": "shell",
      "command": "cd backend && uv run mypy app",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Lint Frontend (Type Check)",
      "type": "shell",
      "command": "cd frontend && npm run lint",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      }
    },
    {
      "label": "Start Full Application",
      "dependsOn": [
        "Run Backend (Development)",
        "Run Frontend (Development)"
      ],
      "dependsOrder": "parallel",
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always"
      }
    },
    {
      "label": "Deploy to Azure",
      "type": "shell",
      "command": "bash deploy_to_azure.sh",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: Build and Deploy Full Stack",
      "dependsOn": [
        "Build Frontend"
      ],
      "type": "shell",
      "command": "echo '‚úÖ Frontend built to backend/static/' && echo 'üì¶ Creating deployment package...' && cd backend && zip -r ../deploy.zip . -x '*.pyc' -x '*__pycache__*' -x '*.git*' -x '*.env*' -x '*.example' -x '*.md' && echo '‚úÖ Package created: deploy.zip' && echo '' && echo 'üöÄ Next steps:' && echo '  1. Push to main branch to trigger GitHub Actions deployment' && echo '  2. Or run: az webapp deployment source config-zip --name BaynunahHRPortal --resource-group BaynunahHR --src ../deploy.zip'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: Check Health Endpoints",
      "type": "shell",
      "command": "echo 'üîç Checking health endpoints...' && echo '' && echo '=== API Health ===' && curl -s https://baynunahhrportal.azurewebsites.net/api/health 2>/dev/null || echo 'Not accessible (may need auth)' && echo '' && echo '=== Database Health ===' && curl -s https://baynunahhrportal.azurewebsites.net/api/health/db 2>/dev/null || echo 'Not accessible' && echo '' && echo '‚úÖ Health check complete'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: View Logs",
      "type": "shell",
      "command": "az webapp log tail --name BaynunahHRPortal --resource-group BaynunahHR",
      "group": "none",
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      }
    },
    {
      "label": "Azure: SSH into App Service",
      "type": "shell",
      "command": "az webapp ssh --name BaynunahHRPortal --resource-group BaynunahHR",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: Restart App Service",
      "type": "shell",
      "command": "echo 'üîÑ Restarting Azure App Service...' && az webapp restart --name BaynunahHRPortal --resource-group BaynunahHR && echo '‚úÖ App Service restarted'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Clean Build Artifacts",
      "type": "shell",
      "command": "rm -rf frontend/dist backend/static backend/__pycache__ backend/**/__pycache__",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Verify Backend Environment",
      "type": "shell",
      "command": "cd backend && echo 'üîç Checking backend environment...' && echo '' && echo '=== Python Version ===' && python3 --version && echo '' && echo '=== UV Version ===' && uv --version 2>/dev/null || echo 'UV not installed' && echo '' && echo '=== .env File ===' && if [ -f .env ]; then echo '‚úÖ .env exists'; else echo '‚ùå .env not found - copy from .env.example'; fi && echo '' && echo '=== Dependencies ===' && uv sync --dry-run 2>/dev/null || echo 'Run: cd backend && uv sync'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: Run Migrations",
      "type": "shell",
      "command": "echo 'üîÑ Running database migrations on Azure...' && az webapp ssh --name BaynunahHRPortal --resource-group BaynunahHR --command 'cd /home/site/wwwroot && python -m alembic upgrade head' && echo '‚úÖ Migrations complete'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: Reset Admin Password",
      "type": "shell",
      "command": "echo 'üîê Resetting admin password...' && echo 'This will reset the admin password to the default DOB format.' && echo '' && read -p 'Enter your AUTH_SECRET_KEY: ' -s AUTH_KEY && echo '' && curl -X POST 'https://baynunahhrportal.azurewebsites.net/api/health/reset-admin-password' -H \"X-Admin-Secret: $AUTH_KEY\" && echo '' && echo '‚úÖ Done! Default credentials: BAYN00008 / 16051988'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: Fix Production Data",
      "type": "shell",
      "command": "echo 'üîß Running production data fix...' && read -p 'Enter your MAINTENANCE_SECRET: ' -s MAINT_KEY && echo '' && curl -X POST \"https://baynunahhrportal.azurewebsites.net/api/health/fix-production?token=$MAINT_KEY\" && echo '' && echo '‚úÖ Production fix complete'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    },
    {
      "label": "Azure: Complete Deployment Workflow",
      "type": "shell",
      "command": "echo 'üöÄ Starting complete Azure deployment workflow...' && echo '' && echo '=== Step 1: Building frontend ===' && cd frontend && npm run build && echo '' && echo '=== Step 2: Creating deployment package ===' && cd ../backend && zip -r ../deploy.zip . -x '*.pyc' -x '*__pycache__*' -x '*.git*' -x '*.env*' -x '*.example' -x '*.md' && echo '' && echo '=== Step 3: Deploying to Azure ===' && cd .. && az webapp deployment source config-zip --name BaynunahHRPortal --resource-group BaynunahHR --src deploy.zip && echo '' && echo '=== Step 4: Verifying deployment ===' && sleep 10 && curl -s https://baynunahhrportal.azurewebsites.net/api/health && echo '' && echo '' && echo '‚úÖ Deployment complete! App is live at: https://baynunahhrportal.azurewebsites.net'",
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "new"
      }
    }
  ],
  "inputs": [
    {
      "id": "migrationMessage",
      "type": "promptString",
      "description": "Enter migration message",
      "default": "migration"
    }
  ]
}
